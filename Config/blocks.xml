<?xml version="1.0" encoding="utf-8" ?>
<!--
  Demonata Gaming Metadata Format ©2025
  SPDX-License-Identifier: LicenseRef-DemonataGaming-Metadata-1.0
  See LICENSE.md for terms.
-->
<!--
  ==================================================
  Blocks Modification – Reclaim Logic for Crates & Lanterns
  @version     1.2.0
  @date        2025-12-17
  @author      Demonata Gaming
  @group       BlockBehaviorAdjustments
  @description
    Reworks drop/reclaim logic for storage crates and lanterns,
    enables pickup for traps and mines, adds infection behavior to gore blocks,
    and adjusts nail drops for wood/log blocks.
    Converts the Apiary and Dew Collector into workstations.
  @notes
  - This file consolidates block-level behavior tweaks across storage, lighting,
    traps/mines, gore, and wood/log resources.
  ==================================================
-->
<configs>
  <!--
  ===============================
  SECTION: STORAGE CRATE DROP CLEANUP
  ===============================
  @group      StorageContainerFixes
  @desc       Removes all non-container drops from writable crate variants.
              Ensures only the crate block itself is returned on Destroy or Harvest.
              Eliminates material/resource returns to prevent crafting loops.
              Removes downgrade paths from secure crates for consistent reclaim behavior.
  -->
  <!-- WOOD: SECURE -->
  <set xpath="/blocks/block[@name='cntWoodWritableCrate']/drop[@event='Destroy'][@name='resourceWood']/@count">0</set>
  <remove xpath="/blocks/block[@name='cntWoodWritableCrate']/property[@name='DowngradeBlock' and @value='cntWoodWritableCrateInsecure']"/>
  <append xpath="/blocks/block[@name='cntWoodWritableCrate']">
    <drop event="Destroy" name="cntWoodWritableCrate" count="1"/>
    <drop event="Harvest" name="cntWoodWritableCrate" count="1"/>
  </append>
  <!-- IRON: SECURE -->
  <set xpath="/blocks/block[@name='cntIronWritableCrate']/drop[@event='Destroy'][@name='resourceScrapIron']/@count">0</set>
  <remove xpath="/blocks/block[@name='cntIronWritableCrate']/property[@name='DowngradeBlock' and @value='cntIronWritableCrateInsecure']"/>
  <append xpath="/blocks/block[@name='cntIronWritableCrate']">
    <drop event="Destroy" name="cntIronWritableCrate" count="1"/>
    <drop event="Harvest" name="cntIronWritableCrate" count="1"/>
  </append>
  <!-- STEEL: SECURE -->
  <set xpath="/blocks/block[@name='cntSteelWritableCrate']/drop[@event='Destroy'][@name='resourceScrapIron']/@count">0</set>
  <remove xpath="/blocks/block[@name='cntSteelWritableCrate']/property[@name='DowngradeBlock' and @value='cntSteelWritableCrateInsecure']"/>
  <append xpath="/blocks/block[@name='cntSteelWritableCrate']">
    <drop event="Destroy" name="cntSteelWritableCrate" count="1"/>
    <drop event="Harvest" name="cntSteelWritableCrate" count="1"/>
  </append>
  <!--
  ===============================
  SECTION: LANTERN DROP CLEANUP
  ===============================
  @group      DecorLightFixes
  @desc       Removes all non-item drops from lanterns.
              Ensures only the placeable lantern item is returned on Destroy or Harvest.
              Prevents electric parts / scrap returns to avoid resource loops.
  -->
  <!-- WHITE LANTERN -->
  <!-- Strip every Destroy drop that isn't the player item -->
  <remove xpath="/blocks/block[@name='lanternDecorLightWhite']/drop[@event='Destroy'][@name!='lanternDecorLightWhite_player']"/>
  <!-- Strip every Harvest drop that isn't the player item -->
  <remove xpath="/blocks/block[@name='lanternDecorLightWhite']/drop[@event='Harvest'][@name!='lanternDecorLightWhite_player']"/>
  <!-- Guarantee self-return on both Destroy and Harvest -->
  <append xpath="/blocks/block[@name='lanternDecorLightWhite']">
    <drop event="Destroy" name="lanternDecorLightWhite_player" count="1"/>
    <drop event="Harvest" name="lanternDecorLightWhite_player" count="1"/>
  </append>
  <!--
  ===============================
  SECTION: TRAP & MINE PICKUP ENABLE
  ===============================
  @group      TrapPickupPermissions
  @desc       Allows players to pick up traps and utility mines once placed.
  @xref       biomes.xml → SECTION: BIOME MINE AND GORE ADDITIONS
  -->
  <append xpath="/blocks/block[@name='trapSpikesWoodMaster']">
    <property name="CanPickup" value="true"/>
  </append>
  <append xpath="/blocks/block[@name='trapSpikesScrapIronMaster']">
    <property name="CanPickup" value="true"/>
  </append>
  <append xpath="/blocks/block[@name='barbedFence']">
    <property name="CanPickup" value="true"/>
  </append>
  <append xpath="/blocks/block[@name='mineCandyTin']">
    <property name="CanPickup" value="true"/>
  </append>
  <append xpath="/blocks/block[@name='mineAirFilter']">
    <property name="CanPickup" value="true"/>
  </append>
  <append xpath="/blocks/block[@name='mineCookingPot']">
    <property name="CanPickup" value="true"/>
  </append>
  <append xpath="/blocks/block[@name='mineHubcap']">
    <property name="CanPickup" value="true"/>
  </append>
  <!--
  ===============================
  SECTION: GORE BLOCK INFECTION
  ===============================
  @group      GoreBlockInfectionChance
  @desc
    Configures gore block properties to apply a 50% infection chance when stepped on
    by the player. These blocks are primarily biome-spawned but may also appear in prefabs.
  @notes
    - This section affects block-level behavior, not buff definitions directly.
    - Infection behavior is triggered via block collision mechanics, not proximity or visual contact.
    - Gore blocks referenced here are introduced as biome decorators in biomes.xml.
  @xref      biomes.xml → SECTION: BIOME MINE AND GORE ADDITIONS
  -->
  <append xpath="/blocks/block[contains(@name, 'gore')]">
    <property name="BuffsWhenWalkedOn" value="buffInfectionMain" prob=".50"/>
  </append>
  <!--
  ===============================
  SECTION: WOOD BLOCK ADJUSTMENTS
  ===============================
  @group      WoodBlockResources
  @desc        Causes some wood block types to give nails back to the player.
	@xref		     recipes.xml → SECTION: NAILS IN RECIPES
	@xref		     loot.xml → MAIN: Increase Nails Loot Chance
  -->
  <append xpath="/blocks/block[starts-with(@name, 'wood')or (contains(@name, 'whitePicketFenceSheet'))or (contains(@name, 'cntCabinetBottom'))or (contains(@name, 'cntCupboardCabinetRedTopClosed'))or (contains(@name, 'cntWoodDesk01Closed'))or (contains(@name, 'cntSecureStorageChest'))or (contains(@name, 'secureDoorWooden'))or (contains(@name, 'endTable'))or (contains(@name, 'ladderWood'))or (contains(@name, 'window03Wood'))or (contains(@name, 'cellarDoorDoubleWood'))and not(contains(@name, 'woodChair1'))and not(contains(@name, 'woodTable'))and not(contains(@name, 'woodFrame'))or (contains(@name, 'oldWoodDoor'))or (contains(@name, 'oldWoodDoorDouble'))or (contains(@name, 'shuttersWoodBlockVariantHelper'))]">
    <drop event="Harvest" name="resourceNail" count="1,2" tag="allHarvest"/>
    <drop event="Destroy" name="resourceNail" count="1,2"/>
    <property name="resourceNail" value="2"/>
  </append>
  <!--
  ===============================
  SECTION: LOG BLOCK ADJUSTMENTS
  ===============================
  @group      LogBlockResourceRemoval
  @desc       Removes nails from log blocks.
	@xref		    recipes.xml → SECTION: LOG BLOCK RECIPE CHANGES
  -->
  <remove xpath="/blocks/block[@name='woodLogPillar100']/drop[@event='Harvest' and @name='resourceNail']"/>
  <remove xpath="/blocks/block[@name='woodLogPillar100']/drop[@event='Destroy' and @name='resourceNail']"/>
  <!--
  ===============================
  SECTION: BEESWAX DROP ADJUSTMENTS
  ===============================
  @group      Beeswax
  @desc         Increases beeswax drop rate.
	@xref		      biomes.xml → SECTION: BIOME HONEY PROBABILITY
  -->
  <append xpath="blocks/block[@name='treeMaster']">
    <drop event="Harvest" name="resourceBeeswax" prob=".05" count="1" tag="WasteTreasuresHoneyHarvest"/>
  </append>
  <!--
  ===============================
  SECTION: APIARY AND DEW COLLECTORS
  ===============================
  @group      Collectors
  @desc         Conversion of Apiary and Dew Collectors to workstations.
	@xref		      Config/XUi/xui.xml → MAIN: XUi Rule Override - Enable Custom Window
                        Config/XUi/windows.xml → MAIN: HUD & UI Adjustments
                        recipes.xml → SECTION:EMPTY JARS HONEY AND WATER CHANGES
                        items.xml → SECTION: EFFECTS CHANGES AND REMOVALS
  @notes       Strategy: Replace Collector with Workstation to enable Jar Input/Attrition Loop.
  -->
  <!-- FULL APIARY CONVERSION TO WORKSTATION -->
  <!--Remove the existing Apiary block -->
  <remove xpath="/blocks/block[@name='cntApiary']"/>
  <!-- Append the new Apiary Workstation -->
  <append xpath="/blocks">
    <block name="cntApiary">
      <property name="Class" value="Workstation"/>
      <property name="Material" value="Mmetal"/>
      <property name="Shape" value="ModelEntity"/>
      <property name="Model" value="@:Entities/Crafting/ApiaryPrefab.prefab"/>
      <property name="ImposterExchange" value="imposterBlock" param1="77"/>
      <property name="MultiBlockDim" value="3,2,1"/>
      <property class="Workstation">
        <property name="Modules" value="tools,input,output"/>
        <property name="CraftingAreaRecipes" value="apiary"/>
      </property>
      <property name="UnlockedBy" value="craftingWorkstations"/>
      <property name="CreativeMode" value="Player"/>
      <property name="LootLabelKey" value="xuiApiary"/>
      <property name="DescriptionKey" value="cntApiaryDesc"/>
      <property name="WorkstationIcon" value="ui_game_symbol_water"/>
      <property name="WorkstationWindow" value="workstation_apiary"/>
      <property name="OpenSound" value="collector_open"/>
      <property name="CloseSound" value="collector_close"/>
      <property name="CraftSound" value="block_apiary_bees"/>
      <property name="SoundPickup" value="apiary_grab"/>
      <property name="SoundPlace" value="apiary_place"/>
      <property name="CraftCompleteSound" value="collector_complete_item"/>
      <property name="Place" value="TowardsPlacerInverted"/>
      <property name="WaterFlow" value="permitted"/>
      <property name="RestrictSubmergedPlacement" value="true"/>
      <property name="AllowedRotations" value="Basic90"/>
      <property name="Path" value="solid"/>
      <property name="IsDecoration" value="true"/>
      <property name="StabilitySupport" value="false"/>
      <property name="EconomicValue" value="500"/>
      <property name="EconomicBundleSize" value="1"/>
      <property name="SellableToTrader" value="false"/>
      <property name="HeatMapStrength" value=".8"/>
      <property name="HeatMapTime" value="5000"/>
      <property name="HeatMapFrequency" value="1000"/>
      <property name="MaxDamage" value="200"/>
      <property name="DestroyFX" value="blockdestroy_cloth,collector_destroy"/>
      <property class="RepairItems">
        <property name="resourceForgedIron" value="10"/>
      </property>
      <drop event="Harvest" name="resourceWood" count="20,30" tag="allHarvest,perkJunkMiner"/>
      <drop event="Harvest" name="resourceScrapIron" count="50,80" tag="allHarvest,perkJunkMiner"/>
      <drop event="Destroy" name="resourceWood" count="20,30"/>
      <property name="SortOrder1" value="B281"/>
      <property name="SortOrder2" value="0100"/>
      <property name="Group" value="Basics,Food/Cooking,Building,advBuilding"/>
      <property name="Tags" value="workstationSkill,twitch_workstation"/>
      <property name="FilterTags" value="MC_playerBlocks,SC_decor"/>
    </block>
  </append>
  <!--FULL DEW COLLECTOR CONVERSION TO WORKSTATION -->
  <!-- Remove Existing Dew Collector -->
  <remove xpath="/blocks/block[@name='cntDewCollector']"/>
  <!-- Append the new Dew Collector Workstation -->
  <append xpath="/blocks">
    <block name="cntDewCollector">
      <property name="Class" value="Workstation"/>
      <property name="Material" value="MFuelBarrelPolymer"/>
      <property name="Shape" value="ModelEntity"/>
      <property name="Model" value="@:Entities/Furniture/collectorDewPrefab.prefab"/>
      <property name="ImposterExchange" value="imposterBlock" param1="77"/>
      <property name="MultiBlockDim" value="3,3,3"/>
      <property class="Workstation">
        <property name="Modules" value="tools,input,output"/>
        <property name="CraftingAreaRecipes" value="dew_collector"/>
        <property name="ToolNames" value="toolDewGatherer,toolDewTarp,toolDewFilter"/>
      </property>
      <property name="UnlockedBy" value="craftingWorkstations"/>
      <property name="CreativeMode" value="Player"/>
      <property name="LootLabelKey" value="xuiDewCollector"/>
      <property name="DescriptionKey" value="dewCollectorDesc"/>
      <property name="WorkstationIcon" value="ui_game_symbol_water"/>
      <property name="WorkstationWindow" value="workstation_dew"/>
      <property name="OpenSound" value="collector_open"/>
      <property name="CloseSound" value="collector_close"/>
      <property name="CraftSound" value="collector_complete_item"/>
      <property name="SoundPickup" value="dewcollector_grab"/>
      <property name="SoundPlace" value="dewcollector_place"/>
      <property name="Place" value="TowardsPlacerInverted"/>
      <property name="WaterFlow" value="permitted"/>
      <property name="RestrictSubmergedPlacement" value="true"/>
      <property name="AllowedRotations" value="Basic90"/>
      <property name="Path" value="solid"/>
      <property name="IsDecoration" value="true"/>
      <property name="StabilitySupport" value="false"/>
      <property name="EconomicValue" value="5"/>
      <property name="EconomicBundleSize" value="1"/>
      <property name="SellableToTrader" value="false"/>
      <property name="MaxDamage" value="200"/>
      <property name="HeatMapStrength" value=".8"/>
      <property name="HeatMapTime" value="5000"/>
      <property name="HeatMapFrequency" value="1000"/>
      <property name="MaxDamage" value="200"/>
      <property name="DestroyFX" value="blockdestroy_cloth,collector_destroy"/>
      <property class="RepairItems">
        <property name="resourceScrapPolymers" value="50"/>
      </property>
      <drop event="Harvest" name="resourceScrapPolymers" count="10,15" tag="allHarvest,perkJunkMiner"/>
      <drop event="Harvest" name="resourceMetalPipe" count="1,3" tag="allHarvest,perkJunkMiner"/>
      <drop event="Destroy" name="resourceScrapPolymers" count="10,15"/>
      <property name="SortOrder1" value="B281"/>
      <property name="SortOrder2" value="0100"/>
      <property name="Group" value="Basics,Food/Cooking,Building,advBuilding"/>
      <property name="Tags" value="workstationSkill,twitch_workstation"/>
      <property name="FilterTags" value="MC_playerBlocks,SC_decor"/>
    </block>
  </append>
</configs>
